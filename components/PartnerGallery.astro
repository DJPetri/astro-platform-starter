---
// Keine Props, alles clientseitig
---

<div id="gallery">Lade Partner...</div>

<script type="module">
  async function fetchPartnerUrls() {
    const res = await fetch('/data/partners.json');
    if (!res.ok) throw new Error('Partner-URLs konnten nicht geladen werden');
    return await res.json();
  }

  async function fetchMetadata(url) {
    try {
      const res = await fetch(`https://api.microlink.io/?url=${encodeURIComponent(url)}`);
      if (!res.ok) throw new Error('Microlink API Fehler');
      const { data } = await res.json();
      return {
        url,
        title: data.title || url,
        description: data.description || '',
        image: data.image?.url || '/fallback.png'
      };
    } catch {
      return {
        url,
        title: url,
        description: 'Keine Vorschau verfügbar.',
        image: '/fallback.png'
      };
    }
  }

  async function loadGallery() {
    const gallery = document.getElementById('gallery');
    gallery.textContent = 'Lade Partner...';

    try {
      const urls = await fetchPartnerUrls();
      const cardsData = await Promise.all(urls.map(fetchMetadata));

      gallery.innerHTML = '';

      for (const { url, title, description, image } of cardsData) {
        const card = document.createElement('a');
        card.href = url;
        card.target = '_blank';
        card.className = 'card';
        card.innerHTML = `
          <img src="${image}" alt="${title}" />
          <h3>${title}</h3>
          <p>${description}</p>
        `;
        gallery.appendChild(card);
      }
    } catch (e) {
      gallery.textContent = 'Fehler beim Laden der Partner.';
      console.error(e);
    }
  }

  loadGallery();
</script>

#gallery {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 1rem;
  padding: 1rem;
}

.card {
  background: white;
  border-radius: 12px;
  padding: 1rem;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transition: transform 0.2s ease;
  display: flex;
  flex-direction: column;
  align-items: center;
  overflow: hidden;
  height: 100%;
  text-decoration: none;
  color: inherit;
}

.card:hover {
  transform: scale(1.03);
}

.card img {
  width: 100px;          /* feste Breite */
  height: 100px;         /* feste Höhe für gleichmäßige Größe */
  object-fit: contain;   /* Bild proportional skalieren, damit nichts verzerrt */
  margin-bottom: 0.75rem;
  flex-shrink: 0;
}

.card h3 {
  margin: 0 0 0.5rem;
  font-size: 1.1rem;
  line-height: 1.2;
}

.card p {
  font-size: 0.9rem;
  color: #555;
  overflow-wrap: break-word;
  flex-grow: 1;
}
